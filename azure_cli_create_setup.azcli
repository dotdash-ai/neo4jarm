templateFile="neo4jarm.json"
paramFile="neo4jarm.parameters.json"
deploymentNameParams=$(cat "neo4jarm.parameters.json" | jq -r ".parameters.deploymentName.value")
deploymentLocation=$(cat "neo4jarm.parameters.json" | jq -r ".parameters.location.value")
now=$(date +"%d-%b-%Y_%H.%M")
DeploymentName=$deploymentNameParams"_"$now

resourceGroup="sshTestBen2"

resourceGroupExists=$(az group exists --name $resourceGroup)

if [[ $resourceGroupExists == "false" ]]
then 
    az group create --location $deploymentLocation --name $resourceGroup
    echo "Resource group $resourceGroup created in $deploymentLocation."
fi

generatedSSHKey=$(az sshkey create --name "neo4jSSHKey" --resource-group $resourceGroup | jq -r ".publicKey")
echo "$generatedSSHKey"

az deployment group create \
 --name $DeploymentName \
 --resource-group $resourceGroup \
 --template-file $templateFile \
 --parameters $paramFile \
 --parameters adminPasswordOrKey="$generatedSSHKey"
#  --parameters adminPasswordOrKey="ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCrxq1z2Xv43KOAT2Lbfuag5MnC9zatgt+NVSwCGl7W9fYSmppRRscHNgWbVDrpZ58dmNe2jIHVwFNfNOho1rcPgPMAEL5kcLVrAoRT3MRwPP7J/xvfthII7eBEx98glkvqEfz3uxaMOTtCTUUCUWXEyjb1g6OHNZIu2Hkp7mexX/AdjtmsgBqBhoPrch1NzlIKOAWKRLDxnnoZxsLBbeJJ55Y15gXRJKOOn4VRs79LHs/u6ghbxgiynWmi6TimlwrU7d1sEPTTzAaZo9fYDJhzd7wFs/5zBV2/0x9o0ybKUQt8bu0bO7pSg1c0Dxk1Y+T5bttSXWWUN9zWSP13jhCDiWfcq1t/jwDLcFz4PPZGBlJV2FY3tlxn4N/lzL6A8nfnOvjHr8IzOdFcMr25jR1klaF5Lh7UkWBquoD83VveI7vkTynnOH3GJ75Ol8PSA1del8esCrNwKfIzLG5hLKn02wBIIYFqsSdCNyozKXtfQ3XhBTAUP5bNF33sNxn2uCk= generated-by-azure"
#  --debug \

 echo "Do not forget to share the private SSH key with whomever you deployed this ARM template for."
 echo "It will be the last SSH key pair created in ~/.ssh/ on your local (this) machine"
 echo ".pub = public, no suffix = private"
 echo "execute 'chmod 600 /home/user/.ssh/privatekey' on your local machine for privacy reasons"